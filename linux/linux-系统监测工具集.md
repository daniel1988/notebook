
Linux系统监测工具有很多，如：tcpdump、nc、strace、lsof、netstat、vmstat、ifstat、mpstat


## 1、tcpdump

tcpdump 是一款经典的网络手提包工具。

    -n  使用IP地址表示主机，而不是主机名；使用数字表示端口号，而不是服务名称

    -i  指定要监听的网卡接口。"-i any"表示抓取所有网卡接口上的数据包

    -v  输出一个稍微详细的信息，如显示IP数据包中的TTL和TOS信息

    -t  不打印时间戳

    -e 　显示以太网帧头道头部信息

    -c  仅抓取指定数量的数据包

    -x  以十六进制数据显示数据包的内容，但不显示包中以太网帧的头部信息

    -X  与-x选项类似，不过还打印每个十六进制对应的ACSII字符

    -s 　设置抓包时的抓取长度。当数据包长度超过抓取长度时，抓取截断的数据包。4.0版本以前，默认的抓取长度为68字节

    -S  以绝对值来显示TCP报文段的序号，而不是相对值

    -w  将tcpdump的输出以特殊的格式定向到某个文件

    -r  从文件读取数据包信息并显示


除了使用选项外，tcpdump还支持用表达式来进一步过滤数据包。tcpdump表达式的操作数分为3种：类型(type)、方向(dir)、协议(proto)


* 类型，　解释其后面紧跟着的参数的含义，tcpdump支持包括host, net, port和portrange。它们　分别指定主机名(IP)用CIDR方法
表示网络地址，端口号以及端口范围。比如，要抓取整个1.2.3.0/255.255.255.0网络上的数据包可以使用

```
$ tcpdump net 1.2.3.0/24
```

* 方向，　src指定数据包的发送端，dst指定数据包的目的端。比如抓取进入端口13457的数据包可以使用

```
tcpdump dst port 13457
```

* 协议，　指定目标的协议。　如

```
tcpdump icmp
```

## 2、lsof

lsof(list open file)是一个列出当前系统打开的文件描述符的工具。通过它可以了解相应进程找开了哪些文件描述符

-i  显示socket 文件描述符

```
lsof -i [46] [protocol][@hostname|ipaddr][:service|port]
```
> 其中，4表示IPv4协议，6表示IPv6协议，protocol指定传输层协议，可以是tcp或者udp，hostname指定主机名等

```
lsof -i@192.168.1.1:22
```

    -u  显示用户启动的所有进程打开的所有文件描述符

    -c  显示指定的命令打开的所有文件描述符

    -p  显示指定进程打开的所有文件描述符

    -t  显示打开了目标文件描述符的进程的PID

## 3、nc

nc(netcat)命令短小精干，功能强大，有着"瑞士军刀"的美誉。它主要用于快速构建网络连接。我们可以让它以服务器
方式运行，监听某个端口并接收客户端的连接。因此它可以用来调试客户端程序。我们也可以使之以客户端方式运行
向服务器发起连接并收发数据。

    -i  设置数据包传送的时间间隔

    -l  以服务器方式运行，监听指定的端口。nc命令默认以客户端方式运行

    -k  重复接受并处理某个端口上的所有连接，必须与-l选项一起使用

    -n  使用IP地址表示主机，而不是主机名，而不是主机名；使用数字表示端口号，而不是服务名称

    -p  当nc命令以客户端方式运行时，强制其使用指定的端口号

    -s  设置本地主机发送出的数据包的IP地址

    -C  将CR和LF两个字符作为行结束符

    -U  使用UNIX本地域协议通信

    -u  使用UDP协议。nc命令默认使用的传输层协议是TCP协议

    -w  如果nc客户端在指定的时间内未检测到任何输入，则退出

    -X  当nc客户端和代理服务器通信时，该选项指定它们之　间使用的通信协议

    -x  指定目标代理服务器的IP地址和端口号

    -z  扫描目标机器上的某或某些服务是否开启

```
nc -z ernest-laptop 20-50
```

连接websrv服务器并向它发送数据

```
nc -C 127.0.0.1 9599
GET http://localhost/index.html HTTP/1.1
Host:localhost
```

## 4、strace

strace是测试服务器性能的重要工具。它跟踪程序运行过程中执行的系统调用和接收到的信号，并将系统调用名、参数
返回值及信号名输出到标准输出或者指定的文件。

    -c 　统计每个系统调用的执行时间、执行次数和出错次数

    -f  跟踪由fork调用生成的子进程

    -t  在输出的每一行信息前加上时间信息

    -e  指定一个表达式，用来控制如何跟踪系统调用（或接收到的信号）其格式是：
```
[qualifier=][!][value1][,value2]...
```
qualifier可以是trace, abbrev, verbose, raw, signal, read 和write 之一,默认trace。value是用于进一步限制被跟踪的
系统调用的符号或数值。它的两个特殊取值是all和none,分别表示跟踪所有由qualifier指定的类型的系统用户和不跟踪
任何该类型的系统调用。

value其他的取值：

    -e trace=set, 只跟踪指定的系统调用。如： -e trace=open, close, read, write表示只跟踪open, close, read, write

    -e trace=file, 只跟踪与文件操作相关的系统调用

    -e trace=process, 只跟踪与进程控制相关的系统调用

    -e trace=network, 只跟踪与网络相关的系统调用

    -e trace=signal, 只跟踪与信号相关的系统调用


## 5、netstat

netstat 是一个功能很强大的网络信息统计工具，它可以打印本地网卡的全部连接、路由表信息、网卡接口信息等。

-n  使用IP地址表示主机，而不是主机名，使用数字表示端口号，而不是服务名称

-a  显示结果中也包含监听socket

-t  仅显示tcp连接

-r 　显示路由信息

-i  显示网卡接口数据流量

-c  每隔１s 输出一次

-o  显示socket定时器的信息

-p 　显示socket所属进程的PID和名字


## 6、vmstat

vmstat是virtual memory statistics的缩写，它能实时输出系统的各种资源的使用情况，比如进程信息、内存使用、cpu使用率等

-f  显示系统自启动来执行的fork次数

-s 　显示内存相关的统计信息以及多种系统活动的数量

-d  显示磁盘相关的统计信息

-p  显示指定磁盘分区的统计信息

-S  使用指定的单位来显示。　参数k , K , m , M 分别代表1000, 1024, 1000000, 1048576字节

delay 采样间隔（单位是s）

count  采样次数，即共输出count次统计信息


## 7、ifstat

ifstat是interface statistics的缩写，它是一个简单的网络流量监测工具


## 8、mpstat

mpstat 是multi-processor sttistics的缩写，它能实时监测多处理器系统上每个cpu的使用情况。mpstat命令和iostat命令
通常都集成在sysstat中，安装sysstat即可获得这两个命令。





















